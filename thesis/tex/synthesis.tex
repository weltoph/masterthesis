\chapter{Synthesis}
\label{chapter:synthesis}
\fxfatal{explain synthesis problem}
\section{Probabilitic Büchi Automata}
The synthesis for \acp{PBA} is - in our current context - understood as the
following question:
\begin{definition}[PBA-Synthesis Question]
  For a given \ac{MDP} $\mathcal{M}$ where the actions are a finite set $O$ and
  a \ac{PBA} $\mathcal{A}$ over the alphabet $S_{\mathcal{M}}\times O$ we want
  to find a strategy that generates for every history
  $\tuple{s_{0}, o_{0}}\dots\tuple{s_{n-1},o_{n-1}}s_{n}$ an
  $o_{n}$ such that the measure induced by the probability of projection to the
  first component induced by $\mathcal{M}$ $\mu$ of those words that lay within
  $L(\mathcal{A})$ is 1.
\end{definition}
Considering a qualitative acceptance condition on $\mathcal{A}$ we can answer
this question positively with
\begin{theorem}[Qualitative PBA Synthesis]
  The synthesis question of an environment $\mathcal{M}$ and a specification
  provided as \ac{PBA} $\mathcal{A}$ with a qualitative acceptance condition
  can be decided.
\end{theorem}
We substantiate this claim by providing a construction of a \ac{WDTA} from the
given environment and the specification \ac{PBA}. The obtained \ac{WDTA} - with
a qualitative acceptance measure - accepts precisely those trees that encode a
strategy as required by the synthesis question.
\begin{definition}[Synthesis WDTA]
  For a \ac{MDP} $\mathcal{M} = \tuple{S, O, \tuple{\tau_{o}}_{o\in O},
  \iota_{0}}$ and a \ac{PBA} $\mathcal{P} = \tuple{Q, S\times O, \delta, q_{0},
  F}$ we construct the \ac{WDTA}
  $\mathcal{A} = \tuple{S\times Q\uplus\set{s_{0}}, s_{0}, S, O, \Delta,
  T}$ with $\Delta(s_{0}, \sigma) = \set{G_{0}}$ where
  \begin{equation*}
    G_{0}(\tuple{s,q}, s') =
    \begin{cases}
      \iota_{0}(s)&\text{ if }s = s'\text{ and }q = q_{0}\\
      0 &\text{ otherwise}
    \end{cases}
  \end{equation*}
  and $\Delta(\tuple{s, q}, \sigma) = \set{G^{s}_{\sigma}}$ where
  \begin{equation*}
    G^{s}_{\sigma}(\tuple{z,p}, z') =
    \begin{cases}
      \delta(q, \tuple{s,\sigma}, p)\cdot\tau_{\sigma}(s,z)&\text{ if }z = z'\\
      0 &\text{ otherwise}
    \end{cases}
  \end{equation*}
  Furthermore we define $T$ as a Büchi condition with $T = S\times F$, i.e. the
  original Büchi condition projected to the second component of the
  states in $\mathcal{A}$.
\end{definition}
The proof is conceptually similar to \cite[Proposition 43]{RandAutoInfTrees} by
examining an integratable function within the product space which coincides
with the characteristic function of the accepted paths in the unique run of
the \ac{WDTA} on a tree $t$, hence the measure of the set of all accepted
paths.

Starting with a tree $t$ we consider two measure spaces, namely the space of
executions in the \ac{MDP} modelling the environment induced by the encoded
strategy of $t$ and the space of the executions of the \ac{PBA} modelling the
specification moving along one execution and using the strategy encoded by $t$.
Thus, we get $\mu^{\mathcal{M}}_{t}$ as a measure on the $\sigma$-algebra
$\mathcal{F}_{\mathcal{M}}$ which is induced by the set of cylinders in
$S_{\mathcal{M}}$. And, we get $\mu^{\mathcal{P}}_{t}$ as a measure on the
$\sigma$-algebra $\mathcal{F}_{\mathcal{P}}$ which is induced
by the set of cylinders in $S_{\mathcal{M}}\times Q_{\mathcal{P}}$. The
semantic of $\mu^{\mathcal{P}}_{t}$ is a merging of runs of
$\mathcal{P}$ on all executions of the environment, i.e. we set
$\mu^{\mathcal{P}}_{t}(\cyl(\tuple{s_{1}, q_{1}}\dots\tuple{s_{n}, q_{n}}))$
as the probability that for the prefix $s_{1}\dots s_{n}$ $\mathcal{P}$
moves along $q_{1}\dots q_{n}$. The product-algebra for these measures is
by \cite[Theorem 22.1]{Bauer} generated by the product of generating sets of
the individual $\sigma$-algebras. Thus, we can understand the product-algebra
$\mathcal{F}$ as the one generated by the product of cylinders over
$S_{\mathcal{M}}$ and $S_{\mathcal{M}}\times Q_{\mathcal{P}}$, i.e. for all
$u\in \tuple{S_{\mathcal{M}}}^{*}$ and
$v\in \tuple{S_{\mathcal{M}}\times Q_{\mathcal{P}}}^{*}$ the sets in
$\cyl(u)\times\cyl(v)$. As suggested in \cite[Remark 35]{RandAutoInfTrees}
these generating cylinders can be \enquote{balanced}.
\begin{lemma}[Balanced Cylinders]
  The $\sigma$-algebra induced by generating sets $\cyl(u)\times\cyl(v)$ with
  $u\in \tuple{S_{\mathcal{M}}}^{n}$ and
  $v\in \tuple{S_{\mathcal{M}}\times Q_{\mathcal{P}}}^{n}$ for all
  $n\in\mathbb{N}$ coincides with $\mathcal{F}$.
\end{lemma}
\begin{proof}
  Since all balanced generators are included in the generators of $\mathcal{F}$
  it is clear that the balanced generators cannot yield a more complex algebra.
  On the other hand we consider arbitrary $u\in \tuple{S_{\mathcal{M}}}^{*}$
  and $v\in \tuple{S_{\mathcal{M}}\times Q_{\mathcal{P}}}^{*}$ and w.l.o.g.
  assume $\size{u}<\size{v}$. There are only finitely many prolongations of $u$
  to the length of $v$ in $S_{\mathcal{M}}$. Let $\set{u_{1},\dots,u_{k}}$ be
  these prolongations. The union of products of $\cyl(v)$ with $\cyl(u_{i})$
  for $1\leq i\leq k$ coincides with the product of $\cyl(v)$ with $\cyl(u)$.
  Thus, balanced generators include all unbalanced generators rendering the
  generated algebras equal.
\end{proof}
