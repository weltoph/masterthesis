\chapter{Synthesis}
\fxfatal{explain synthesis problem}
\section{Probabilitic Büchi Automata}
The synthesis for \acp{PBA} is - in our current context - understood as the
following question:
\begin{definition}[PBA-Synthesis Question]
  For a given \ac{MDP} $\mathcal{M}$ where the actions are a finite set $O$ and
  a \ac{PBA} $\mathcal{A}$ over the alphabet $S_{\mathcal{M}}\times O$ we want
  to find a strategy that generates for every history
  $\tuple{s_{0}, o_{0}}\dots\tuple{s_{n-1},o_{n-1}}s_{n}$ an
  $o_{n}$ such that the measure induced by the probability of projection to the
  first component induced by $\mathcal{M}$ $\mu$ of those words that lay within
  $L(\mathcal{A})$ is 1.
\end{definition}
Considering a qualitative acceptance condition on $\mathcal{A}$ we can answer
this question positively with the following Theorem
\begin{theorem}[Qualitative PBA Synthesis]
  The synthesis question of an environment $\mathcal{M}$ and a specification
  provided as \ac{PBA} $\mathcal{A}$ with a qualitative acceptance condition
  can be decided.
\end{theorem}
We substantiate this claim by providing a construction of a \ac{WDTA} from the
given environment and the specification \ac{PBA}. The obtained \ac{WDTA} - with
a qualitative acceptance measure - accepts precisely those trees that encode a
strategy as required by the synthesis question.
\begin{definition}[Synthesis WDTA]
  For a \ac{MDP} $\mathcal{M} = \tuple{S, O, \tuple{\tau_{o}}_{o\in O},
  \iota_{0}}$ and a \ac{PBA} $\mathcal{P} = \tuple{Q, S\times O, \delta, q_{0},
  F}$ we construct the \ac{WDTA}
  $\mathcal{A} = \tuple{S\times Q\uplus\set{s_{0}}, s_{0}, S, O, \Delta,
  T}$ with $\Delta(s_{0}, \sigma) = \set{G_{0}}$ where
  \begin{equation*}
    G_{0}(\tuple{s,q}, s') =
    \begin{cases}
      \iota_{0}(s)&\text{ if }s = s'\text{ and }q = q_{0}\\
      0 &\text{ otherwise}
    \end{cases}
  \end{equation*}
  and $\Delta(\tuple{s, q}, \sigma) = \set{G^{s}_{\sigma}}$ where
  \begin{equation*}
    G^{s}_{\sigma}(\tuple{z,p}, z') =
    \begin{cases}
      \delta(q, \tuple{s,\sigma}, p)\cdot\tau_{\sigma}(s,z)&\text{ if }z = z'\\
      0 &\text{ otherwise}
    \end{cases}
  \end{equation*}
  Furthermore we define $T$ as a Büchi condition with $T = S\times F$, i.e. the
  original Büchi condition projected to the second component of the
  states in $\mathcal{A}$.
\end{definition}
First of all, we observe that $\mathcal{A}$ is deterministic. And secondly, we
have - given a strategy $\varphi_{\mathcal{M}}$ for the environment - a
probability distribution $\mu_{\varphi_{\mathcal{M}}}$ over the
$\sigma$-algebra that is induced by the cylinders over $S_{\mathcal{M}}$.
Furthermore, we can obtain for every word
$\alpha\in\tuple{S_{\mathcal{M}}\times O}^{\omega}$ a probability distribution
$\mu_{\alpha}$ over the $\sigma$-algebra that is induced by the cylinders over
$Q$. Now, we argue that the run of $\mathcal{A}$ does precisely model the
product distribution of these two probability distributions if the underlying
tree is understood as strategy for the environment. Since $\mathcal{A}$ runs on
trees of the form $t:S_{\mathcal{M}}^{*}\rightarrow O$ they can be directly
understood as strategies for $\mathcal{M}$. Also, such a $t$ induces an
infinite word on $S_{\mathcal{M}}\times O$ by
$s_{1}t(s_{1})s_{2}t(s_{1}s_{2})\dots$. This cummulates into
\begin{lemma}[Product Measure PBA]
  The unique run of $\mathcal{A}$ on a tree $t$ induces a probability measure
  $\lambda$ on the $\sigma$-algebra induced by the cylinders over
  $S_{\mathcal{M}}\times Q$ which is equivalent to the product measure
  $\mu_{\varphi_{t}}\otimes \mu_{\alpha}$.
\end{lemma}
\begin{proof}
  This proof separates into two parts: on the one hand we show the equivalence
  of the $\sigma$-algebras and on the other hand we show that the measures on
  the generating sets of cylinders agree which then yields the claimed
  equivalence.
\item [Algebras]
  The generating sets of the $\sigma$-algebra induced by the run $r$ of
  $\mathcal{A}$ on $t$ are cylinders over the set
  $\tuple{\tuple{S_{\mathcal{M}}\times Q}\times S_{\mathcal{M}}}$ while the
  $\sigma$-algebra of the product space is generated by the products of all
  generating sets of the individual generating sets, i.e. for all
  $u\in S_{\mathcal{M}}^{*}$ and $v\in Q^{*}$ the product of $\cyl(u)$ and
  $\cyl(v)$. First of all, balance the length of the generating prefixes $u, v$
  without changing the generated $\sigma$-algebra: we claim to obtain the
  product algebra if we only take for every $n$ and $u\in S_{\mathcal{M}}^{n}$,
  $v\in Q^{n}$ the product of $\cyl{u}$ and $\cyl{v}$. Fix two arbitrary
  $u\in S_{\mathcal{M}}^{*}$, $v\in Q^{*}$ and assume w.l.o.g.
  $\size{u} > \size{v}$. There are finitely many possibilities to prolong
  $v$ in $Q$ to the length $\size{u}$. Let $v_{1},\dots, v_{n}$ be these
  prolongations.
\end{proof}
