\chapter{Synthesis}
\label{chapter:synthesis}
\section{Open Synthesis}

\section{Strategy Synthesis for \ac{POMDP}}
\subsection{Probabilistic BÃ¼chi Automata}
The synthesis for \acp{PBA} is - in our current context - understood as the
following question:
\begin{definition}[PBA-Synthesis Question]
  Given a \ac{POMDP} $\mathcal{M}$ and a \ac{PBA} $\mathcal{P}$ with
  \begin{equation*}
    \mathcal{M} = \tuple{S, s_{0}, A, \tuple{\tau_{a}}_{a\in A}, \sim}
  \text{ and }
    \mathcal{P} = \tuple{Q, q_{0}, S, \delta, F}
  \end{equation*}
  exists a strategy $s:\interval{S}_{\sim}^{*}\rightarrow A$ such that 
  almost-all executions of $\mathcal{A}$ under $s$ are accepted by 
  $\mathcal{P}$?
  \label{def:synthesis}
\end{definition}
Considering a qualitative acceptance condition on $\mathcal{P}$ we can answer
this question positively with
\begin{theorem}[Qualitative PBA Synthesis]
  The synthesis question of an environment $\mathcal{M}$ and a specification
  provided as \ac{PBA} $\mathcal{A}$ with a qualitative acceptance measure
  can be decided.
  \label{thm:pbasynthesis}
\end{theorem}

Considering a certain restricted class of \acp{MDP}, namely those where for 
every state ever following state is defined by a probability distribution $B$
(regardless of the action chosen by the player), then this result can be 
derived as a corollary from the construction examined in Example 
\ref{ex:pwapbaallpaths}. Although the following construction bears structural
similarities with the one presented there, the arguments used here are a little 
more involved.

\begin{proof}
  We fix one strategy $s:\interval{S}_{\sim}^{*}\rightarrow A$ which induces a 
  probability space
  \begin{equation*}
    \tuple{S^{\omega},\mathcal{B}(S), \mu_{s}}.
  \end{equation*}
  Furthermore, for any given $\alpha\in S^{\omega}$ the stochastic process of
  $\mathcal{P}$ also yields a probability space
  \begin{equation*}
    \tuple{Q^{\omega},\mathcal{B}(Q), \mu_{\alpha}}.
  \end{equation*}
  The analytical complexity is rooted in the dependency of $\mu_{\alpha}$ from
  $\alpha$. We approach this dependency in terms of \emph{Markov-kernels}. We
  define (analogously to \cite[Definition 8.25]{Klenke})
  \begin{definition}[Markov-Kernel]
    For two measurable spaces $\tuple{\Omega_{1},\mathcal{F}_{1}}$ and 
    $\tuple{\Omega_{2},\mathcal{F}_{2}}$ a function
    \begin{equation*}
      K:\Omega_{1}\times\mathcal{F}_{2}\rightarrow\interval{0,1}
    \end{equation*}
    is called a Markov-kernel if
    \begin{enumerate}
      \item $K(\cdot, A)$ is measurable in $\mathcal{F_{1}}$ for all 
        $A\in\mathcal{F}_{2}$,
      \item $K(\omega, \cdot)$ is a probability measure on 
        $\tuple{\Omega_{2},\mathcal{F}_{2}}$ for every $\omega\in\Omega_{1}$.
    \end{enumerate}
  \end{definition}
  We define the following Markov-kernel
  \begin{equation*}
    K:S^{\omega}\times\mathcal{B}(Q)\rightarrow\interval{0,1}\text{ with }
      K(\alpha, A) = \mu_{\alpha}(A)
  \end{equation*}
  for the measurable spaces $\tuple{S^{\omega},\mathcal{B}(S)}$ and 
  $\tuple{Q^{\omega},\mathcal{B}(Q)}$. The central inside arises from Lemma 
  \ref{lem:almosteverywhere} which allows us to state
  \begin{equation*}
    \int_{S^{\omega}}K(\cdot, \Acc(F)) d\mu_{s} 
    = \int_{\alpha\in S^{\omega}}\mu_{\alpha}(\Acc(F))d\mu_{s} = 1 \text{ iff }
      \mu_{s}(K(\cdot,\Acc(F))^{-1}(1)) = 1.
  \end{equation*}
  This characterises the synthesis question from Definition \ref{def:synthesis}
  since $\mu_{s}(K(\cdot,\Acc(F))^{-1}(1))$ is the set of executions which are
  accepted by an almost-sure measure by $\mathcal{P}$. Notably, we can assure 
  this statement only under the premise that $K(\cdot, \Acc(F))$ is indeed 
  measurable. This is a direct consequence if $K$ is a Markov-kernel since 
  $\Acc(F)\in\mathcal{B}(Q)$. We address this condition with the following
  \begin{lemma}
    $K$ as defined above is a Markov-kernel.
  \end{lemma}
  \begin{proof}
    With $K(\alpha,\cdot) = \mu_{\alpha}$ it is trivial to state that 
    $K(\alpha,\cdot)$ defines a probability measure for 
    $\tuple{Q^{\omega},\mathcal{B}(Q)}$.

    We refer to \cite[Remark 8.26]{Klenke} to justify that we only check the 
    second condition for cylindric $A\in\mathcal{B}(Q)$, i.e. $A = \cyl(u)$ for 
    some $u\in Q^{*}$. Fundamentally, we observe that by definition of the 
    transition probabilities for a \ac{PBA} we obtain for any $u\in S^{n}$ and 
    $\alpha, \beta\in\cyl(u)$ that
    \begin{equation*}
      \mu_{\alpha}(\cyl(v)) = \mu_{\beta}(\cyl(v))\text{ for all }v\in Q^{n}.
    \end{equation*}
    This justifies the use of the notion $\mu_{u}$.
    By \cite[Theorem 9.2]{Bauer} the measurability of $K(\cdot, \cyl(u))$ is
    implied if for all $a\in\mathbb{R}$
    \begin{equation*}
      \set{\alpha\in S^{\omega}\mid K(\alpha, \cyl(v))\leq a}\in\mathcal{B}(S).
    \end{equation*}
    Observably,
    \begin{equation*}
      \set{\alpha\in S^{\omega}\mid K(\alpha, \cyl(v))\leq a} = 
        \bigcup\set{
          \cyl(u):u\in S^{\size{v}}\text{ and }\mu_{u}(\cyl(v))\leq a
        }
    \end{equation*}
    implies the necessary membership in $\mathcal{B}(S)$ since $S^{\size{v}}$ 
    is finite.
  \end{proof}
\end{proof}
