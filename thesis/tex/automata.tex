\chapter{Languages and Automata}
It is well established to rely on finite automata to recognize languages of
infinite objects, e.g. trees or words \cite{LangAutoLog}. In this chapter we
recall some known results for languages of infinite words and infinite trees.
Furthermore, building upon the work in \cite{RandAutoInfTrees}, we introduce and
examine a new class of tree automata, called \aclp*{WDTA}. In Chapter
\ref{chapter:synthesis} we use these class of automata to (re-)prove some
synthesis results in the context of probabilistic environments.

\section{$\omega$-regular Languages}
Following \cite{LangAutoLog} we introduce word automata with the following
structural definition
\begin{definition}[Word Automaton]
  We define a word automaton as
  $\mathcal{A} = \tuple{Q, \Sigma, q_{0}, \Delta}$ where
  $Q$ is a set of states, $\Sigma$ a finite alphabet, $q_{0}\in Q$ is the
  initial state and $\Delta\subseteq Q\times\Sigma\times Q$ is the transition
  relation. We define some associated notions as follows:
  \begin{description}
    \item [Run]
      For a word $\alpha = \alpha_{0}\alpha_{1}\dots\in\Sigma^{\omega}$ we call
      a sequence $\pi = \pi_{0}\pi_{1}\dots \in Q^{\omega}$ a run of
      $\mathcal{A}$ on $\alpha$ if $\pi_{0} = q_{0}$ and for every
      $i\in\mathbb{N}$ holds that
      $\tuple{\pi_{i}, \alpha_{i}, \pi_{i+1}}\in\Delta$
    \item [Determinism]
      We call $\mathcal{A}$ deterministic if for every pair $q\in Q$ and
      $\sigma\in\Sigma$ the set
      $\set{p\in Q\mid\tuple{q,\sigma,p}\in\Delta}$ has at most one
      element.
  \end{description}
\end{definition}
and expand upon this structure by classifying runs on word automata as
accepting or non-accepting by the following conditions:
\begin{definition}[Acceptance Conditions]
  For a word automaton $\mathcal{A} = \tuple{Q, \Sigma, q_{0}, \Delta}$ we
  define different acceptance conditions. For this we define for a run
  $\pi = \pi_{0}\pi_{1}\dots\in Q^{\omega}$ the operator
  $\Inf$ as the set of states that occur infinitely in a run, i.e.
  \begin{equation*}
    \Inf(\pi) = \set{q\in Q\middle| \text{ there are infinitely many }
    i\in\mathbb{N} \text{ s.t. } \pi_{i} = q}
  \end{equation*}
  With this notion we define the following acceptance conditions:
  \begin{description}
    \item [Büchi] A Büchi condition is defined by a set of final states
      $F\subseteq Q$ and we call a run $\pi$ accepting if
      $\Inf(\pi)\cap F\neq\emptyset$.
    \item [Muller] Muller conditions are given as a family of state sets, i.e.
      $\mathcal{F}\subseteq 2^{F}$. A run $\pi$ is called accepting if
      $\Inf(\pi)\in\mathcal{F}$.
    \item [Rabin] This acceptance condition is represented by a set of pairs\\
      $\Omega = \set{\tuple{E_{0}, F_{0}}, \dots, \tuple{F_{n}, E_{n}}}$ and we
      call a run $\pi$ accepting if there is an $i$ s.t.
      $\Inf(\pi)\cap F_{i}\neq\emptyset$ but $\Inf(\pi)\cap E_{i} = \emptyset$.
    \item [Streett] The Streett condition is dual to the Rabin condition and
      thus also given by a set of pairs
      $\Omega = \set{\tuple{E_{0}, F_{0}}, \dots, \tuple{F_{n}, E_{n}}}$. But
      this time we want that the Rabin condition is not fulfilled, i.e. for a
      run $\pi$ and all $i$ we have either $\Inf(\pi)\cap F_{i} = \emptyset$ or
      $\Inf(\pi)\cap E_{i} \neq \emptyset$.
    \item [Parity] This condition is defined
      by a function
      $\parity:Q\rightarrow \mathbb{N}$. We call a run $\pi$ accepting if the
      maximum of the set $\parity(\Inf(\pi))$, which describes the pointwise
      application of $\parity$ to the set $\Inf(\pi)$, is even (note that due
      to the finiteness of $Q$, $\Inf(\pi)$ is finite as well and thus the
      maximum of $\parity(\Inf(\pi))$ exists).
  \end{description}
\end{definition}\fxfatal{find fitting reference for parity condition} 
We categorize word automata by their acceptance condition and if they are
deterministic. Thus, we call a word automaton $\mathcal{A}$ equipped with a
Büchi condition a \ac{NBA} or respectively \ac{DBA} if
$\mathcal{A}$ is deterministic. And analogously we obtain word automata for
Muller, Rabin, Streett and Parity conditions and corresponding acronyms.
\acuse{NMA}
\acuse{DMA}
\acuse{NRA}
\acuse{DRA}
\acuse{NSA}
\acuse{DSA}
\acuse{NPA}
\acuse{DPA}
It is known that all these automata (except for \acp{DBA}) do have the same
expressiveness.
\begin{theorem}
  \cite[Proposition 5.3, Theorem 5.4, Proposition 5.6]{LangAutoLog}
  \fxfatal{find one fitting reference}
  The class of recognizable languages coincides for \acp{NBA}, \acp{NMA},
  \acp{DMA}, \acp{NRA}, \acp{DRA}, \acp{NSA}, \acp{DSA}, \acp{NPA} and
  \acp{DPA}.
\end{theorem}

\section{Probabilistic Büchi Automata}
Upon the concept of \acp{NBA} there are approaches to substitute the
non-deterministic choices by probabilities for the choices
(see \cite{RecOmeLangProbAuto,DecProblemsForProbAuto,Groesser}). In order to
properly define these automata we introduce the concept of \aclp{MDP}.
\aclp*{MDP} can be used to model a system which reacts to the actions of an
agent (often called player) probabilisticly.\fxfatal{more general reference for
MPD}
More formally we use these definitions which follow \cite{RandAutoInfTrees}:
\begin{definition}[Markov Decision Process]
  A \acl*{MDP} is modelled as tuple
  $\tuple{S, A, \tuple{\tau_{a}}_{a\in A}, s_{0}}$ where $S$ is a set of states
  and $A$ a set of actions. Given an action $a\in A$ the corresponding
  transition function $\tau_{a}:S\times S\rightarrow \interval{0,1}$ satisfies
  for every $q\in S$ that $\sum_{p\in S}\tau_{a}\tuple{q,p} = 1$.
  $s_{0}$ is the initial state. Additionally we define a few helpful
  auxilliaries:
  \begin{description}
    \item [Cylinder] For a finite word of states $w\in S^{*}$ we define the
      corresponding cylinder as the set of all infinite state-sequences
      that can prolong $w$: $\cyl(w) = w\cdot S^{\omega}$.
    \item [Plays] We consider all infinite sequences of states
      (i.e. $S^{\omega}$) that start in $s_{0}$ a valid play. All plays
      are gathered in $\plays = \set{
        \alpha\in S^{\omega}\mid \alpha_{0} = s_{0}} = \cyl(s_{0})$.
    \item [Strategy] We define $\varphi:S^{*}\rightarrow A$ as strategy for
      a \ac{MDP}. Such a strategy models interaction with a \ac{MDP} by
      giving a specific $a\in A$ to which the \ac{MDP} reacts by $\tau_{a}$.
    \item [Initial Distribution] Occasionally, we substitute the initial state
      $s_{0}$ with an initial probability distribution
      $\iota_{0}:S\rightarrow[0,1]$ which allows the plays to start in any
      $s\in S$ such that $\iota_{0}(s) > 0$.
  \end{description}
  \fxfatal{again find nice reference for the general mdp things}
  \label{def:mdp}
\end{definition}
We examine the ring induced by the set of cylinders of a \ac{MDP} $\mathcal{A}$
and for a given strategy $\varphi_{\mathcal{A}}$ we obtain an induced
probability for the cylinders as follows:
\begin{equation}
  \mu_{\varphi}(\cyl(w = w_{0}\dots w_{n})\cap\plays) = \begin{cases}
    \prod_{i=1}^{n-1}\tau_{\varphi(w_{0}\dots w_{i})}(w_{i}, w_{i+1})
      &\text{ if }\cyl(w)\cap\plays\neq\emptyset\\
    0 &\text{ otherwise}
  \end{cases}
\end{equation}
We can close the set of cylinders under finite union by associating
the probability measure for $\cyl(v)\cup\cyl(u)$ to the sum of both cylinders
if $u$ and $v$ are two finite words but neither $v$ is prefix of $u$ nor $u$
is prefix of $v$.
\begin{equation}
  \mu_{\varphi}(\cyl(v)\cup\cyl(u)) = \mu_{\varphi}(\cyl(v)) 
  + \mu_{\varphi}(\cyl(u))
\end{equation}
In this fashion we obtained a pre-measure (induced by a strategy $\varphi$) on
the ring of cylinders (cp. \cite[Chapter 1 and Chapter 3]{Bauer}). This
pre-measure can now be uniquely extended to a probability measure on the
$\sigma$-algebra induced by the set of cylinders \cite[Theorem 5.4]{Bauer}.

Given this definition of \acp{MDP} we can now examine \acp{PBA}. A \ac{PBA}
essentially is a \ac{NBA} where the non-determinism is solved by a probability
distribution. More formally, we define analogously to \cite{Groesser}
\begin{definition}[Probabilistic Büchi Automata]
  A \acl{PBA} $\mathcal{A}$ over a finite alphabet $\Sigma$ is defined by a
  tuple $\tuple{Q, \Sigma, \delta, q_{0}, F}$ where $Q$ is a finite state set,
  $q_{0}\in Q$ the initial state,
    $\delta:Q\times\Sigma\times Q\rightarrow \interval{0,1}$
  a transition probability function such that for all pairs $q\in Q$ and
  $\sigma\in\Sigma$ we have $\sum_{p\in Q}\delta(q,\sigma,p)\in\set{0,1}$
  and $F\subseteq Q$ is the set of final states.
\end{definition}
Note that this definition may also be altered to allow initial distributions
rather than one initial state \cite{RecOmeLangProbAuto}.
\acp{PBA} can be interpreted as \acp{MDP} where the decisions in every state
are induced by a word $\alpha = \alpha_{1}\alpha_{2}\dots\in\Sigma^{\omega}$
rather than a player. For a \ac{PBA} $\mathcal{A}$ we can easily define a
corresponding strategy $\varphi_{\alpha}:Q^{*}\rightarrow\Sigma$ for the
equivalent \ac{MDP} $\mathcal{M}_{\mathcal{A}} =
   \tuple{Q, \Sigma, \tuple{\tau_{\sigma}}_{\sigma\in\Sigma}, q_{0}}$
where $\tau_{\sigma}(q,p) = \delta(q,\sigma,p)$ as
$\varphi_{\alpha}(w) = \alpha_{\size{w}}$. This strategy yields a probability
measure $\mu_{\alpha}$ on $Q^{\omega}$ and we can define whether $\mathcal{A}$ 
accepts $\alpha$ by this measure; namely by the measure of the set
$\mathcal{F}\subseteq Q^{\omega}$ of words that satisfy the Büchi condition
given by $F_{\mathcal{A}}$. It is known that this set $\mathcal{F}$ is
measurable and we define different acceptance conditions \cite{Groesser}:
\begin{description}
  \item [Positive Acceptance] $\mu_{\alpha}(\mathcal{F}) > 0$
  \item [Almost-Sure Acceptance] $\mu_{\alpha}(\mathcal{F}) = 1$
  \item [Threshold Acceptance] $\mu_{\alpha}(\mathcal{F}) > \lambda$ for a
    fixed threshold $\lambda\in[0, 1)$
\end{description}

Examining an induced strategy $\varphi_{\alpha}$ of a word
$\alpha\in\Sigma^{\omega}$ it is noteworthy that the strategy operates
indifferently regarding the state the play is in. We use this observation to
motivate the introduction of \acp{POMDP}. A \ac{POMDP} is a \ac{MDP}
$\mathcal{M}$ with an associated equivalence relation $\sim$
\cite{RandAutoInfTrees}. The equivalence relation models a restriction of the
player to observe the state of $\mathcal{M}$. For every
$s\in S_{\mathcal{M}}$ we define
$[s]_{\sim} = \set{r\in S\mid \sim(r,s)}$ and
$S_{\mathcal{M}}/_{\sim}$ as set of all these equivalence classes. A
strategy for a \ac{POMDP} $\tuple{\mathcal{M}, \sim}$ is defined as
$\varphi:(S_{\mathcal{M}}/_{\sim})^{*}\rightarrow A_{\mathcal{M}}$.
\begin{example}
  Re-examining a \ac{PBA} $\mathcal{A}$ and the equivalent \ac{MDP}
  $\mathcal{M}$ we observed that every word $\alpha$ induces a corresponding
  strategy $\varphi_{\alpha}$. But not every strategy induces a word because
  strategies on $\mathcal{M}$ may choose depending on the state of the play
  different letters for plays of the same length which creates an inconsistency
  with respect to an - hypothetical - associated word. To tackle this, we add
  to $\mathcal{M}$ an equivalence relation
  $\sim = S_{\mathcal{M}} \times S_{\mathcal{M}}$ (as suggested in
  \cite{DecProblemsForProbAuto}), hence there is exactly one equivalence class.
  Firstly, we observe that $\varphi_{\alpha}$ is still a valid strategy for the
  resulting \ac{POMDP} $\mathcal{P} = \tuple{\mathcal{M}, \sim}$. Secondly,
  since there is exactly one equivalence class every strategy for $\mathcal{P}$
  observes at any time only the length of the history. Hence we can provide an
  equivalent strategy of the form $\varphi:\mathbb{N}\rightarrow \Sigma$. This
  in turn means that every strategy in $\mathcal{P}$ induces a word in
  $\Sigma^{\omega}$ of the form $\varphi(0)\varphi(1)\dots$. Furthermore, the
  measure of one strategy and an associated word coincide, i.e. the language of
  $\mathcal{A}$ can be understood as strategy space for $\mathcal{P}$ and vice
  versa. This illustrates an idea which is used to define emptiness games for
  certain automata (e.g. \cite[Proposition 45]{RandAutoInfTrees}).
  \label{ex:pba}
\end{example}

\section{Tree Automata}
\fxfatal{elaborate on classical tree automata}
Building upon \cite{RandAutoInfTrees} we expand on the notion of weighting
the different paths of the run. Hereby, we incorporate the concept of
\emph{alternation} by allowing to send different states on the same path
through the tree with individual weight. Thus, we capture on transition in a
probability function over states and directions of an automaton.
\begin{definition}[Generator]
  For a set of states $Q$ and a set of directions $D$ we call a probability
  function on $Q\times D$, i.e. $G: Q\times D\rightarrow [0,1]$ with
  $\sum\limits_{\substack{q\in Q\\ d\in D}}G(q,d) = 1$, a generator over $Q$
  and $D$. A finite set of generators over sets $Q$ and $D$ is called a clause
  $C = \set{G_{1},\dots,G_{n}}$.
\end{definition}
With these transitions we adapt the common concepts of tree automata by
allowing the automaton to build a run of \enquote{transitions}.
\begin{definition}[Weighted Descent Tree Automaton]
  We define a \acl{WDTA} as tuple
  $\mathcal{A} = \tuple{Q, q_{0}, D, \Sigma, \Delta, T}$ where $Q$ is a finite
  set of states, $q_{0}$ the initial state, $D$ a finite set of directions,
  $\Sigma$ is a finite Alphabet and $T\subseteq Q^{\omega}$ is a
  $\omega$-regular target of infinite words of elements in $Q$. The transitions
  in $\Delta$ are given as clauses for every state and symbol:
  $\Delta:Q\times\Sigma\rightarrow\mathcal{C}^{Q}_{D}$
  where $\mathcal{C}^{Q}_{D}$ denotes the set of all clauses over $Q$ and $D$.
  Additionally, we define the set of all used generators as
  $\mathcal{G}_{\mathcal{A}} = \bigcup\limits_{q\in Q,\sigma\in\Sigma}
    \Delta(q,\sigma)$.
\end{definition}
The semantics of a \ac{WDTA} $\mathcal{A}$ is given as a run
$r:(Q\times D)^{*}\rightarrow \mathcal{G}_{\mathcal{A}}$ on a tree
$t:D^{*}\rightarrow\Sigma$ with $r(\epsilon)\in \Delta(q_0, t(\epsilon))$ and
for every $\tuple{q_{1},d_{1}}\dots\tuple{q_{n},d_{n}}\in(Q\times D)^{*}$ we
have $r(\tuple{q_{1},d_{1}}\dots\tuple{q_{n},d_{n}})\in
  \Delta(q_{n},t(d_{1}\dots d_{n}))$. Analogously to a strategy in Definition
\ref{def:mdp} a run induces a probability measure on the set of cylinders
in $(Q\times D)^{\omega}$ by
\begin{equation}
  \mu_{r}(\cyl(\tuple{q_{1},d_{1}}\dots\tuple{q_{n},d_{n}}))
    = r(\epsilon)(q_{1},d_{1})\cdot\prod\limits_{i = 1}^{n - 1}
    r(\tuple{q_{1},d_{1}}\dots\tuple{q_{i},d_{i}})(q_{i+1},d_{i+1})
\end{equation}
Naturally, we want to define acceptance of a run in terms of its induced
measure on the set of paths that satisfy the target $T_{\mathcal{A}}$ when
projected to the state component. Thus, we show (by adapting the proof for
\cite[Proposition 6]{RandAutoInfTrees}) the measurability of that set.
\begin{lemma}[Measurability]
  The set
  \begin{equation*}
    \set{\alpha = \tuple{q_{1},d_{1}}\tuple{q_{2},d_{2}}\dots\in
    (Q\times D)^{\omega}\mid q_{0}q_{1}q_{2}\dots\in T_{\mathcal{A}}}
  \end{equation*} is measurable in the $\sigma$-algebra that is induced by the
  ring of cylinders.
  \label{lemma:measurabilityAcceptance}
\end{lemma}
\begin{proof}
  We start with the co-Büchi condition which is dual to the Büchi condition.
  Specifically, a co-Büchi condition is also defined by a set of
  states $E\subseteq Q$ which in contrast must eventually be avoided. More
  precisely, such a set $E$ defines the accepted language as
  $\set{\alpha_{0}\alpha_{1}\dots\in Q^{\omega}\mid\text{ there is } i
  \text{ such that for all } j>i \text{ holds }\alpha_{j}\notin E}$.
  By abuse of notation we write in the following
  $\tuple{q, d}\in E$ if $q\in E$. With
  \begin{equation*}
    \prolong(u) = \set{v\in (Q\times D)^{*}\mid u\sqsubseteq v}
  \end{equation*} and
  \begin{equation*}
    T = \set{\alpha_{0}\alpha_{1}\dots\in (Q\times D)^{\omega}\mid\text{ there
    is } i \text{ such that for all } j>i \text{ holds }\alpha_{j}\notin E}
  \end{equation*}
  we claim that
  \begin{equation} 
    T = \bigcup\limits_{u\in (Q\times D)^{*}}(
    \cyl(u)\setminus\bigcup\limits_{v\in\prolong(u),v\in E}\cyl(v))
    \label{eq:measureability}
  \end{equation}
  which renders $T$ measurable as countable union of measurable sets.
  For $b\in T$ we know that there is eventually no occurence of $E$
  anymore. This induces that for every finite prefix $u\sqsubseteq b$ after the
  last occurence of an element in $E$ holds
  $b\notin\bigcup\limits_{v\in\prolong(u),v\in E}\cyl(v))$ and thus $b$
  is element of the right hand side of Equation \ref{eq:measureability}. On the
  other hand if $b\notin T$ we know that for every finite prefix
  $u\sqsubseteq b$ there is a prolongation $u\sqsubseteq v\sqsubseteq b$ such
  that the last element of $v$ is in $E$, hence $b$ is for every such $u$
  removed with by the cylinder associated with $v$ since $v\in\prolong(u)$.
  This yields that $b$ is not element of the right hand side of Equation
  \ref{eq:measureability} which proves the proclaimed equality. Additionally,
  we get measureability of all Büchi conditions $F\subseteq Q$ by using its
  duality to the co-Büchi condition $Q\setminus F$ and the closure of a
  $\sigma$-algebra under complementation.

  For a parity condition we get finitely many parities as
  $\parity(Q) = \set{d_{1},\dots,d_{n}}$. We define for an arbitrary set
  $E\subseteq Q$ the set $\cob(E)$ which is the set of accepted paths if
  $E$ is interpreted as co-Büchi condition and $\bue(E)$ which is the set of
  accepted path if $E$ is interpreted as Büchi condition. We already know that
  these sets are measureable. With these auxilliaries we can define the
  accepted paths of a parity condition $\parity$ by
  \begin{equation}
    \bigcup\limits^{1\leq i\leq n}_{d_{i}\text{ even}}\tuple{\bue(\parity^{-1}(d_{i}))
    \bigcap\bigcup\limits^{1\leq j\leq n}_{d_{j} > d_{i}, d_{j}\text{ odd}}
    \cob(\parity^{-1}(d_{j}))}
  \end{equation}
  which yields measureability of the accepted paths of a parity condition.
  Analogously, for a Muller condition $\mathcal{F} = \set{F_{1},\dots,F_{n}}$
  we can define
  \begin{equation}
    \bigcup\limits_{1\leq i\leq n}
    \tuple{\bue(F_{i})\bigcap\cob(Q\setminus F_{i})}
  \end{equation}
  Since Streett and Rabin conditions can be expressed as Muller conditions
  (see \cite[Proposition 5.3]{LangAutoLog}) this implies measurability for
  these conditions as well.
\end{proof}
In the following we often focus on parity conditions and motivate this by the
observation that parity conditions can be used to express all other conditions
(as suggested but not proven in \cite[page 24:9]{RandAutoInfTrees}).
\begin{lemma}
  For every \ac{WDTA} $\mathcal{A}$ with a Büchi, Streett, Rabin or Muller
  acceptance condition we can construct an equivalent \ac{WDTA} $\mathcal{B}$
  with a parity condition.
\end{lemma}
\begin{proof}
  Firstly, we observe that Büchi, Streett and Rabin conditions can be expressed
  as Muller conditions \cite[Proposition 5.3]{LangAutoLog}. Secondly, we
  construct for a \ac{WDTA} $\mathcal{A} = \tuple{Q, q_{0}, D, \Sigma, \Delta,
  \mathcal{F} = \set{F_{1},\dots,F_{n}}}$ with a Muller condition $\mathcal{F}$
  an equivalent \ac{WDTA} $\mathcal{B}$ with a parity condition via the use of
  a \ac{LAR} (analogously to e.g. \cite{MullerSchupp} for unweighted tree
  automata). The idea of an \ac{LAR} is to keep a record of the order of
  recently visited states which eventually stabilizes to those states seen
  infinitely often. Using a \ac{LAR} increases the state space but preserves
  the structure, especially the weighting, of a run and thus yields the same
  measure of the set of accepted paths. \fxfatal{this does not precisely follow
  Muller Schupp but InfCompGames and a reference shall be found accordingly}
  \begin{definition}[Latest Appearance Record]
    For a finite state set $Q$ define the set of permutations of elements in
    $Q$ as $\perm(Q)\subseteq Q^{\size{Q}}$ and
    \begin{equation*}
      \lar(Q) = \set{\interval{w,h}\mid w\in\perm(Q)\text{ and }1\leq
      h\leq\size{Q}}
    \end{equation*}
    Additionally we define an update function
    $\up:\lar(Q)\times Q\rightarrow\lar(Q)$ with
    \begin{equation*}
      \up(\interval{q_{1}\dots q_{n},h}, q)
      = \interval{qq_{1}\dots q_{i-1}q_{i+1}\dots q_{n},i}
      \text{ for the unique }i\text{ s.t. }q=q_{i}
    \end{equation*}
    and conclude with one auxillary definition:
    \begin{description}
      \item [Hit set] for $\ell = \interval{q_{1}\dots q_{n},h}$ we call
        $\set{q_{1},\dots,q_{h}}$ the hit set of $\ell$.
    \end{description}
  \end{definition}
  For a word $q_{1}q_{2}\dots\in Q^{\omega}$ we can obtain one associated
  sequence of elements in $\lar(Q)$ by picking one arbitrary starting value
  $\ell_{1}$ and successively applying the update operation, i.e.
  $\ell_{1}\ell_{2}\dots\in\lar(Q)^{\omega}$ with
  $\ell_{i+1} = \up(\ell_{i},q_{i})$ for all $i>0$. We can now state that
  $\Inf(q_{1}q_{2}\dots)$ moves to the beginning of the $\lar(Q)$ elements in
  the associated sequence
  \begin{lemma}
    \cite[Lemma 2.1]{MullerSchupp}
    $\Inf(q_{1}q_{2}\dots) = F$ if and only if from one $k>0$ the hit set of
    all $\ell_{i}$ for $i>k$ is a subset of $F$ and there are infinitely many
    $i>k$ s.t. the hit set of $\ell_{i}$ coincides with $F$.
  \end{lemma}
  This Lemma induces that the sequence of hit sets stabilises to the set
  $\Inf(q_{1}q_{2}\dots)$. Thus, $q_{1}q_{2}\dots$ satisfies a Muller condition
  $\mathcal{F}$ if and only if the hit sets stabilises to an element of
  $\mathcal{F}$. This can be captured within a parity condition by associating
  to $\ell = \interval{p_{1}\dots p_{n},h}$ with hit set
  $H = \set{p_{1},\dots,p_{h}}$ a parity condition
  \begin{equation*}
    \parity(\ell) = \begin{cases}
      2\cdot\size{H} &\text{ if }H\in\mathcal{F}\\
      2\cdot\size{H}-1 &\text{ if }H\notin\mathcal{F}
    \end{cases}
  \end{equation*}
  Thus, winning hit sets do have an even and losing hit sets do have an odd
  parity and notably the highest parity value is even if and only if
  $\Inf(q_{1}q_{2}\dots)\in\mathcal{F}$.
  We construct
  $\mathcal{B}=\tuple{\lar(Q),\ell_{0}, D, \Sigma, \Delta',\parity}$ where
  $\ell_{0}$ is one arbitrary element of $\lar(Q)$ and $\parity$ is defined as
  described above for the Muller condition of $\mathcal{A}$. For every clause
  $\Delta(q,\sigma) = \set{G_{1},\dots,G_{n}}$ we define
  $\Delta'(\ell,\sigma) = \set{G_{1}',\dots,G_{n}'}$ with
  \begin{equation*}
    G_{i}'(\ell', d) = \begin{cases}
      G_{i}(q,d) &\text{ if }\ell' = \up(\ell,q)\\
      0          &\text{ otherwise}
    \end{cases}
  \end{equation*}
  This yields that every run of $\mathcal{A}$ on a tree $t$ induces a run of
  $\mathcal{B}$ on $t$ by substituting every $G$ by $G'$ and vice versa. Since
  the set of accepting paths in both runs have the same measure we obtain the
  equivalence of $\mathcal{A}$ and $\mathcal{B}$.
\end{proof}
We say that $\mathcal{A}$ accepts $t$ if an accepting run exists where the
notion of an accepting run is (analogously to \acp{PBA}) tied to an
\enquote{acceptable measure}, e.g. Positive Acceptance or Almost-Sure
Acceptance. It is remarkable that these measures of the accepted sets solely
depend on the occured states rather than the direction throughout the run-tree.
This motivates the following definition of an auxillary measure.
\begin{definition}[State measure]
  On the $\sigma$-algebra that is induced by the ring of cylinders in
  $Q^{\omega}$ a run $r$ of $\mathcal{A}$ induces a measure $\lambda$.
  This measure $\lambda$ is defined as the unique extension of the pre-measure
  induced by cylinders of finite words $w = w_{1}\dots w_{n}\in Q^{*}$
  \begin{equation*}
    \lambda_{r}(\cyl(w)) = \sum\limits_{d_{1}\dots d_{n}\in D^{n}}\mu_{r}(
      \cyl(\tuple{w_{1}, d_{1}}\dots\tuple{w_{n},d_{n}}))
  \end{equation*}
\end{definition}
The acceptance of a run can be defined in terms of state measures.
\begin{lemma}[State measure acceptance]
  For a run $r$ of \ac{WDTA} $\mathcal{A}$ on $t$ holds
  \begin{equation*}
    \lambda_{r}(T_{\mathcal{A}}) = \mu_{r}(\set{\tuple{q_{1},d_{1}}
    \tuple{q_{2},d_{2}}\dots\in\tuple{Q\times D}^{\omega}\mid q_{1}q_{2}\dots\in T})
  \end{equation*}
\end{lemma}
\begin{proof}
  By definition holds for all elements of the generating set, i.e. the set of
  cylinders, the equality
  \begin{align*}
    \lambda_{r}(\cyl(w)) &= \sum\limits_{d_{1}\dots d_{n}\in D^{n}}\mu_{r}(
      \cyl(\tuple{w_{1}, d_{1}}\dots\tuple{w_{n},d_{n}}))\\
      &= \mu_{r}\tuple{\bigcup\limits_{d_{1}\dots d_{n}\in D^{n}}
      \cyl(\tuple{w_{1}, d_{1}}\dots\tuple{w_{n},d_{n}})}
  \end{align*}
  which induces the claim, since the measures of measurable sets are obtained
  by the calculation rules of a measure on these generating sets.
  \fxwarning{we maybe should elaborate here more}
\end{proof}
This allows to define acceptance in terms of state measures.
\begin{corollary}
  A run $r$ of $\mathcal{A}$ on $t$ is 
  \begin{description}
    \item[Positively Accepting] iff $\lambda_{r}(T_{\mathcal{A}}) > 0$
    \item[Almost-Surely Accepting] iff $\lambda_{r}(T_{\mathcal{A}}) = 1$
  \end{description}
\end{corollary}
Additionally, we define certain structural properties on \acp{WDTA}
\begin{definition}[Structural Properties]
  A \ac{WDTA} $\mathcal{A}$ is called
  \begin{description}
    \item [deterministic] if there is at most one generator in each clause, i.e.
      for every pair $q\in Q, \sigma\in\Sigma$ holds
      $\size{\Delta(q, \sigma)} \leq 1$.
    \item [uni-directional] if for every clause there is at most one state send
      to every direction, i.e. for every $G\in\mathcal{G}_{\mathcal{A}}$
      there is at most one $q\in Q$ such that $G(q, d) > 0$ for all
      $d\in D$. Intuitively this means that the automaton explores every path
      with at most one state.
    \item [uniformly distributed (u.d.)] if $\mathcal{A}$ is uni-directional
      and for a direction $d\in D$ every clause agrees on the weight that is
      sent down that direction. Thus, for all $d\in D$ holds that for all
      $G_{1}, G_{2}\in\mathcal{G}_{\mathcal{A}}$ we have
      $G_{1}(q, d) = G_{2}(p, d)$ for the unique $q, p$ for which
      $G_{1}(q, d) > 0$, respectively $G_{2}(p, d) > 0$ or
      $G_{1}(q, d) = G_{2}(p, d) = 0$ for all $q, p$. Thus, we can fix a
      probability distribution $B:D\rightarrow \interval{0,1}$ such that for
      every $G\in\mathcal{G}_{\mathcal{A}}$ there is one $q\in Q$ with
      $B(d) = G(q, d)$. We call this distribution $B$ the \emph{blueprint} of
      $\mathcal{A}$. 
  \end{description}
\end{definition}
The examined tree automata in \cite{RandAutoInfTrees} are therefore captured by
uniformly distributed \acp{WDTA} over the directions $D = \set{0,1}$ with
blueprint $B(0) = B(1) = \frac{1}{2}$.

\subsection{Closure Properties}
In the following we want to explore the closure properties of the introduced
\acp{WDTA} regarding union, intersection and negation. Unsuprisingly, the
non-determinism of the model induces closure under union for certain classes in
a straightforward manner (as suggested by \cite{RandAutoInfTrees}). We
generally only examine these properties for automata over the same set of
directions and the same alphabet.
\begin{proposition}[Union - uni-directional, unrestricted]
  Uni-directional and unrestricted \acp{WDTA} are closed under union.
  \label{prop:uniunrunion}
\end{proposition}
\begin{proof}
  For two automata
  $\mathcal{A}_{1} = \tuple{Q, q_{0}, D, \Sigma, \Delta_{1}, T_{1}}$ and
  $\mathcal{A}_{2} = \tuple{P, p_{0}, D, \Sigma, \Delta_{2}, T_{2}}$ we can
  w.l.o.g. assume that $Q\cap P = \emptyset$. The union \ac{WDTA} guesses in
  the very first transition which of the automata is checked for the tree:
  \begin{equation*}
    \tuple{Q\cup P\cup\set{z}, z, D, \Sigma,
    \Delta_{1}\cup\Delta_{2}\cup\set{
      \tuple{z,\sigma}\mapsto C_{\sigma}}_{\sigma\in\Sigma}, T_{1}\cup T_{2}}
  \end{equation*}
  where $z$ is a new state and
  $C_{\sigma} = \Delta_{1}(q_{0},\sigma)\cup\Delta_{2}(p_{0}, \sigma)$. Thus,
  in $z$ the decision if a generator from $\mathcal{A}_{1}$ or
  $\mathcal{A}_{2}$ is chosen determines for which automata the run is
  generated. It is noteworthy that every run is in bijection to a run of
  $\mathcal{A}_{1}$ or $\mathcal{A}_{2}$ and thus induces the same measurement
  on the set of accepted paths and that this construction preservers
  uni-directionality.
\end{proof}
\begin{corollary}
  The class of u.d. \acp{WDTA} with a fixed blueprint $B$ is closed under
  union.
\end{corollary}
\begin{proof}
  The construction for Proposition \ref{prop:uniunrunion} respects a common
  blueprint of $\mathcal{A}_{1}$ and $\mathcal{A}_{2}$.
\end{proof}
\fxwarning{what about u.d. with different blueprints? more general question:
how are non-determinism and weighting related? orthogonal or dependent?}
\fxfatal{intersection?! naive approach does not work, what about more elaborate
thoughts?}

\subsection{Emptiness}
Similarly to \acp{PBA}, we want to define for a given \ac{WDTA} $\mathcal{A}$
a game that captures the behaviour of $\mathcal{A}$. Again, this will result in
the definition of \ac{POMDP}. This game is designed to go through the following
steps:
\begin{enumerate}
  \item initially, the player chooses any $G\in\mathcal{G}_{\mathcal{A}}$
    such that $G\in\Delta(q_{0},\sigma)$ for any $\sigma\in\Sigma$
  \item then the game moves to a position $\tuple{q,d}\in\tuple{Q\times D}$
    with probability $G(q,d)$
  \item the player is not allowed to observe the state of the current position
    but may choose dependent on the observed direction $d$ one
    $\sigma\in\Sigma$ and a transition $G\in\Delta(q,\sigma)$ for every
    $q\in Q$
  \item the game proceeds to any $\tuple{q,d}$ with the corresponding
    probability $G(q,d)$
\end{enumerate}
Similiar to Example \ref{ex:pba} a strategy only represents a tree if for every
play the choice of a letter $\sigma$ is consistent throughout all plays
associated with one certain word of directions. Therefore, we introduce in the
choice of the player the restriction of observation in step $3$. This allows
the player to exclusively observe the directions taken throughout the game and
base his decision of which letter to place on this observation only.
Furthermore, we merge steps step $2$ and $3$ into one action of the player
since separation into two distinct steps entails the neccessity to model that
certain pairs of state and letter may not have a corresponding transition
present. In terms of the automaton this means that such a situation renders the
partial run invalid. It is common to introduce a sink state and enforce for
every invalid action to move towards it. But this is - dependent on the
accepted measure - not viable, since it is in general not possible to complete
automata with a positive acceptance semantics since this allows to obtain runs
that may not have been possible before but still have a positive acceptance
measure in a different subtree
\cite[cp. Introduction to chapter 3.8]{RandAutoInfTrees}.\fxfatal{allow for
runs to have a bottom symbol which is ignored if only hit with probability 0
but otherwise invalidates the run to allow for invalidation of runs at any
moment}
\begin{definition}[Emptiness Game]
  For a \ac{WDTA} $\mathcal{A} = \tuple{Q, q_{0}, D, \Sigma, \Delta, T}$ we
  fix the set of actions $A$ for the player as a set
  \begin{equation*}
    A = Q\rightarrow\Delta_{\sigma}
  \end{equation*}
  where $\tuple{Q\rightarrow\Delta_{\sigma}}$ is the set of functions that map
  for one fixed $\sigma$ a state $q\in Q$ to a generator in $\Delta(q,\sigma)$.
  The emptiness game is then defined as a \ac{POMDP}
  \begin{equation*}
    \mathcal{M}_{\mathcal{A}} = \tuple{\tuple{Q\times D}\uplus q_{0}, A,
    \tuple{\tau_{a}}_{a\in A}, q_{0}}
  \end{equation*}
  where
  \begin{equation*}
    \tau_{f}(\tuple{q,d},\tuple{q',d'}) = f(q)(q',d')
  \end{equation*}
  and the associated observation relation is $\sim$ with
  \begin{equation*}
    \tuple{q, d}\sim\tuple{p, d'}\text{ if and only if } d = d'
  \end{equation*}
\end{definition}
The observation restriction renders the actions of a player to be only
dependent of the directions and not the states. Thus, for a strategy $\varphi$
we can obtain a corresponding tree by following the directions of the history
and placing the element $\sigma\in\Sigma$ that the player chooses for his
action. Equipping \acp{MDP} and \acp{POMDP} analogously to automata with
objectives allows to synthesis strategies for the player that try to satisfy
the objective \cite{RandAutoInfTrees}. Thus, equipping the \ac{POMDP} of the
emptiness game above with the corresponding objective on the states allows to
obtain accepted trees from a possible strategy.
\fxfatal{Show equivalence, gather decideability and undecideability results
for strategy synthesis; for uni-directional WDTAs we can drop the observation
relation, since there is only one state at any position at any time which
allows for stronger acceptance conditions}
\begin{corollary}[Emptiness Almost-Sure Büchi WDTA]
  The emptiness problem for a \ac{WDTA} with almost-sure acceptance measure of
  a Büchi condition can be decided in exponential time.
  \label{cor:emptiness}
\end{corollary}
\begin{proof}
  Apply \cite[Theorem 5]{QualAnaPOMDP} to the corresponding emptiness game.
\end{proof}
\begin{corollary}[Emptiness Almost-Sure Uni-Directional WDTA]
  The emptiness problem for an uni-directional \ac{WDTA} with almost-sure
  acceptance measure of a $\omega$-regular condition can be decided in
  polynomial time.
\end{corollary}
\begin{proof}
  Apply \cite[Theorem 3]{RandAutoInfTrees} to the corresponding emptiness game.
\end{proof}

\subsection{Equivalence of \acp*{WDTA} and \acp*{PBA}}
By reducing the directions to a singelton set a tree degenerates to a single
path. This path can be interpreted as one word and thus, we can incorporate the
concept of \acp{PBA} into the theory of \acp{WDTA} by the following theorem
\begin{theorem}
  For every \ac{PBA} $\mathcal{P}$ existent an equivalent \ac{WDTA}
  $\mathcal{A}$ and for every \ac{WDTA} $\mathcal{A}$ with
  $\size{D_{\mathcal{A}}} = 1$ exists an equivalent \ac{PBA}.
  \label{theorem:pbaequiv}
\end{theorem}
\begin{proof}
  For a \ac{PBA} $\mathcal{P} = \tuple{Q, \Sigma, \delta, q_{0}, F}$ we define
  \ac{WDTA} $\mathcal{A} = \tuple{Q, q_{0}, \set{0}, \Sigma, \Delta, F}$ with
  $\Delta(q,\sigma) = \set{G_{q}^{\sigma}}$ and
  $G_{q}^{\sigma}(p, 0) = \delta(q, \sigma, p)$. A word
  $\alpha\in\Sigma^{\omega}$ can be expressed equivalently as function
  $\alpha:\mathbb{N}\rightarrow\Sigma$ and with the bijective mapping of $0^n$
  to $n$ we obtain an equivalent tree $\alpha:\set{0}^{*}\rightarrow\Sigma$.
  The (unique) run of $\mathcal{A}$ on $\alpha$ is in bijection to the runtree
  of $\mathcal{P}$ on $\alpha$ which yields the claimed equality.
\end{proof}
This directly entails some undecideability results carried over from \acp{PBA}.
\begin{corollary}
  The undecideability of the emptiness problem for \acp{PBA} with positive
  acceptance \cite{Groesser} renders the emptiness problem for \acp{WDTA} with
  positive acceptance undecideable.
\end{corollary}
\begin{corollary}
  The emptiness problem for \acp{WDTA} with almost-sure acceptance is
  undecideable.
\end{corollary}
\begin{proof}
  By \cite[Proof of Theorem 1]{DecProblemsForProbAuto} there is an equivalent
  probabilistic Rabin automaton for which the accepted paths have either
  measure $0$ or $1$ for every \ac{PBA} with positive acceptance. Thus, for the
  the equivalent \ac{WDTA} to this probabilistic Rabin automaton positive and
  almost-sure acceptance coincides rendering the emptiness problem for both
  acceptance criteria undecideable.
\end{proof}
Note that this undecideability result does not contradict the decideable
emptiness for \acp{WDTA} with Büchi condition and almost-sure acceptance but
simply shows that Büchi conditions are less expressive (as it is for
non-weighted tree automata\fxfatal{find reference}).

\subsection{A forrest of languages}
The different structural properties of \acp{WDTA} introduce different language
classes. We explore in the following how these classes are related to each
other. First of all, we notice that determinism obviously is a restriction.
\begin{proposition}
  The class of languages recognizable with \acp{WDTA} almost-sure acceptance
  is a proper superset of languages recognizable with determinisitc \acp{WDTA}
  with almost-sure acceptance.
\end{proposition}
\begin{proof}
  For u.d. \acp{WDTA} with a common blueprint this follows from
  \cite[Proposition 10]{RandAutoInfTrees}.
  The general case is a little more elaborate but yields an interesting
  intuition: non-deterministic \acp{WDTA} allow for search of properties on
  one path while determinism entails a spread of weight and thus cannot
  recognize properties on one, finitly many or countably many paths if all
  paths are examined. \fxfatal{elaborate}
\end{proof}
It is a very interesting result that alternation in non-weighted tree automata
does not increase the general expressiveness (see \cite{MullerSchupp}).
This result does unfortunately not translate unconstraint to the weighted case.
\begin{proposition}
  The class of languages recognizable with uni-directional \acp{WDTA} with
  Büchi condition is incomparabel with the class of languages recognizable with
  deterministic \acp{WDTA} with Büchi condition under almost-sure acceptance.
\end{proposition}
\begin{proof}
  It is known from \cite[Theorem 4 (b), (c)]{DecProblemsForProbAuto} that
  $\omega$-regular languages and languages recognizable by \acp{PBA} are
  incomparable. We consider the inverse of Theorem \ref{theorem:pbaequiv} for
  \acp{WDTA} over a singleton direction set. Let $D$ be a set with $\size{D}=1$
  and $\mathcal{D} = \tuple{Q, q_{0}, D, \Sigma, \Delta, F}$ a deterministic
  \ac{WDTA}, hence w.l.o.g. (under almost-sure acceptance we can complete
  automata with a non-accepting sink state)
  $\Delta(q,\sigma) = \set{G^{q}_{\sigma}}$. We can straightforwardly define an
  equivalent \ac{PBA} $\mathcal{P} = \tuple{Q, \Sigma, \delta, q_{0}}$ with
  $\delta(q, \sigma, p) = G^{q}_{\sigma}(p, d)$ for the one $d\in D$. Since the
  runtree of $\mathcal{P}$ coincides with the unique run of $\mathcal{D}$ on
  any $\alpha$ the equivalence is obvious. Let
  $\mathcal{U} = \tuple{P, p_{0}, D, \Sigma, \Delta', F'}$ be a uni-directional
  \ac{WDTA}. Since there is only one $d\in D$ and every transition in
  $\mathcal{U}$ is only allowed to put weight into one state per direction
  every run of $\mathcal{U}$ on any $\alpha$ can be reduced to one path with
  weight $1$. This path is either accepting or non-accepting and thus
  remarkably the class of accepted languages of those \ac{WDTA} is the class
  of $\omega$-regular languages. Remarkably, we can for any \ac{PBA} define an
  equivalent uni-directional \ac{WDTA} (for any transition from $q$ to $p$ in
  the word automaton introduce a transition in the tree automaton that puts all
  its weight from $q$ to $p$). The claimed incomparability translates
  immediately from the incomparability of the word automata.
\end{proof}
\begin{corollary}
  For Büchi conditions there are deterministic \acp{WDTA} that do not have an
  equivalent uni-directional \ac{WDTA} with any acceptance measure.
\end{corollary}
\begin{proof}
  In above construction the measure of the one path of a run in an
  uni-directional \ac{WDTA} is binary ($1$ if the path is accepting and $0$
  otherwise). Thus the acceptance measures coincide. For the \ac{PBA} the
  runtree is in bijection to the run of the \ac{WDTA} and
  \cite[Theorem 4]{RecOmeLangProbAuto} states that \acp{PBA} with positive
  measure are more expressive than $\omega$-regularity.
\end{proof}
